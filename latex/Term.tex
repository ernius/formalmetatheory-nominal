\begin{code}%
\>\AgdaKeyword{module} \AgdaModule{Term} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Atom}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{ListProperties}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Chi}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{NaturalProperties}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Bool} \AgdaKeyword{hiding} \AgdaSymbol{(}\_∨\_\AgdaSymbol{;}\_≟\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Product} \AgdaKeyword{renaming} \AgdaSymbol{(}map \AgdaSymbol{to} mapₓ\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Sum} \AgdaKeyword{renaming} \AgdaSymbol{(}\_⊎\_ \AgdaSymbol{to} \_∨\_\AgdaSymbol{;}map \AgdaSymbol{to} map+\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Empty}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Function}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Nullary}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Nullary.Decidable}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality} \AgdaSymbol{as} \AgdaModule{PropEq} \AgdaKeyword{hiding} \AgdaSymbol{(}[\_]\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List.Any} \AgdaSymbol{as} \AgdaModule{Any} \AgdaKeyword{hiding} \AgdaSymbol{(}map\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List.Any.Properties}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List.Any.Membership}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{Any.}\AgdaModule{Membership-≡} \AgdaKeyword{renaming} \AgdaSymbol{(}\_∈\_ \AgdaSymbol{to} \_∈'\_\AgdaSymbol{;}\_∉\_ \AgdaSymbol{to} \_∉'\_\AgdaSymbol{)} \<[57]%
\>[57]\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat} \AgdaSymbol{as} \AgdaModule{Nat} \AgdaKeyword{hiding} \AgdaSymbol{(}\_⊔\_\AgdaSymbol{;}\_*\_\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat.Properties}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{DecTotalOrder} \AgdaFunction{Nat.decTotalOrder} \AgdaKeyword{using} \AgdaSymbol{()} \AgdaKeyword{renaming} \AgdaSymbol{(}refl \AgdaSymbol{to} ≤-refl\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{≤-Reasoning}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{renaming} \AgdaSymbol{(}begin\_ \AgdaSymbol{to} start\_\AgdaSymbol{;} \_∎ \AgdaSymbol{to} \_◽\AgdaSymbol{;} \_≡⟨\_⟩\_ \AgdaSymbol{to} \_≤⟨\_⟩'\_\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{infix} \<[7]%
\>[7]\AgdaNumber{9} \_·\_ \<%
\\
\>\AgdaKeyword{infix} \<[7]%
\>[7]\AgdaNumber{5} （\_∙\_）\_ \<%
\\
\>\AgdaKeyword{infix} \<[7]%
\>[7]\AgdaNumber{3} \_∈\_ \_∉\_ \_\#\_ \_*\_\<%
\\
\>\<%
\end{code}

%<*term>
\begin{code}%
\>\AgdaKeyword{data} \AgdaDatatype{Λ} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{v} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaFunction{Atom} \AgdaSymbol{→} \AgdaDatatype{Λ} \<[18]%
\>[18]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{\_·\_} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaDatatype{Λ} \<[19]%
\>[19]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{ƛ} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaFunction{Atom} \AgdaSymbol{→} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaDatatype{Λ} \<%
\end{code}
%</term>

\begin{code}%
\>\AgdaFunction{∣\_∣} \AgdaSymbol{:} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaDatatype{ℕ}\<%
\\
\>\AgdaFunction{∣} \AgdaInductiveConstructor{v} \AgdaBound{a} \AgdaFunction{∣} \<[11]%
\>[11]\AgdaSymbol{=} \AgdaNumber{1}\<%
\\
\>\AgdaFunction{∣} \AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N} \AgdaFunction{∣} \<[11]%
\>[11]\AgdaSymbol{=} \AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣} \AgdaPrimitive{+} \AgdaFunction{∣} \AgdaBound{N} \AgdaFunction{∣}\<%
\\
\>\AgdaFunction{∣} \AgdaInductiveConstructor{ƛ} \AgdaBound{a} \AgdaBound{M} \AgdaFunction{∣} \<[11]%
\>[11]\AgdaSymbol{=} \<[14]%
\>[14]\AgdaNumber{1} \AgdaPrimitive{+} \AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemma∣M∣>0} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣} \AgdaFunction{>} \AgdaInductiveConstructor{zero}\<%
\\
\>\AgdaFunction{lemma∣M∣>0} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{x}\AgdaSymbol{\}} \<[20]%
\>[20]\AgdaSymbol{=} \AgdaInductiveConstructor{s≤s} \AgdaInductiveConstructor{z≤n}\<%
\\
\>\AgdaFunction{lemma∣M∣>0} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \<[20]%
\>[20]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{start}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{suc} \AgdaInductiveConstructor{zero}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≤⟨} \AgdaFunction{lemma∣M∣>0} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≤⟨} \AgdaFunction{m≤m+n} \AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣} \AgdaFunction{∣} \AgdaBound{N} \AgdaFunction{∣} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣} \AgdaPrimitive{+} \AgdaFunction{∣} \AgdaBound{N} \AgdaFunction{∣}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≤⟨} \AgdaFunction{≤-refl} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{∣} \AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N} \AgdaFunction{∣}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{◽}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemma∣M∣>0} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{a} \AgdaBound{M}\AgdaSymbol{\}} \<[20]%
\>[20]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{start}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{suc} \AgdaInductiveConstructor{zero} \<[15]%
\>[15]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≤⟨} \AgdaInductiveConstructor{s≤s} \AgdaInductiveConstructor{z≤n} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaInductiveConstructor{suc} \AgdaSymbol{(}\AgdaInductiveConstructor{suc} \AgdaInductiveConstructor{zero}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≤⟨} \AgdaInductiveConstructor{s≤s} \AgdaSymbol{(}\AgdaFunction{lemma∣M∣>0} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\})} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaNumber{1} \AgdaPrimitive{+} \AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≤⟨} \AgdaFunction{≤-refl} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{∣} \AgdaInductiveConstructor{ƛ} \AgdaBound{a} \AgdaBound{M} \AgdaFunction{∣}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{◽}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemma∣va∣} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{∣} \AgdaBound{N} \AgdaFunction{∣} \AgdaDatatype{≤′} \AgdaNumber{1} \AgdaSymbol{→} \AgdaRecord{Σ} \AgdaFunction{Atom} \<[41]%
\>[41]\AgdaSymbol{(λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaBound{N} \<[51]%
\>[51]\AgdaDatatype{≡} \AgdaInductiveConstructor{v} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma∣va∣} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{a}\AgdaSymbol{\}} \<[19]%
\>[19]\AgdaBound{|N|≤1} \<[28]%
\>[28]\AgdaSymbol{=} \AgdaBound{a} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{lemma∣va∣} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \<[19]%
\>[19]\AgdaBound{|MN|≤1} \<[28]%
\>[28]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaFunction{>1→¬≤1} \AgdaSymbol{\{}\AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣} \AgdaPrimitive{+} \AgdaFunction{∣} \AgdaBound{N} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{lemmam>0∧n>0→m+n>1} \AgdaSymbol{\{}\AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{∣} \AgdaBound{N} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{lemma∣M∣>0} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\})} \AgdaSymbol{(}\AgdaFunction{lemma∣M∣>0} \<[127]%
\>[127]\AgdaSymbol{\{}\AgdaBound{N}\AgdaSymbol{\}))} \AgdaSymbol{(}\AgdaFunction{≤′⇒≤} \AgdaBound{|MN|≤1}\AgdaSymbol{))} \<[148]%
\>[148]\<%
\\
\>\AgdaFunction{lemma∣va∣} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{a} \AgdaBound{M}\AgdaSymbol{\}} \<[19]%
\>[19]\AgdaBound{|ƛaM|≤1} \<[28]%
\>[28]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaFunction{>1→¬≤1} \AgdaSymbol{\{}\AgdaNumber{1} \AgdaPrimitive{+} \AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaFunction{lemmam>0∧n>0→m+n>1} \AgdaSymbol{\{}\AgdaNumber{1}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{∣} \AgdaBound{M} \AgdaFunction{∣}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{s≤s} \AgdaInductiveConstructor{z≤n}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma∣M∣>0} \AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}))} \AgdaSymbol{(}\AgdaFunction{≤′⇒≤} \AgdaBound{|ƛaM|≤1}\AgdaSymbol{))} \<[133]%
\>[133]\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{\_∈\_} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{)} \AgdaSymbol{:} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{∈v} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaBound{a} \AgdaDatatype{∈} \AgdaInductiveConstructor{v} \AgdaBound{a} \<[17]%
\>[17]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{∈·r} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \<[15]%
\>[15]\AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \<[31]%
\>[31]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∈} \AgdaBound{N} \<[40]%
\>[40]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∈} \AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{∈·l} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \<[15]%
\>[15]\AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∈} \AgdaBound{M} \<[31]%
\>[31]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∈} \AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{∈ƛr} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \<[25]%
\>[25]\AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \<[31]%
\>[31]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∈} \AgdaBound{M} \<[40]%
\>[40]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∈} \AgdaInductiveConstructor{ƛ} \AgdaBound{b} \AgdaBound{M}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{∈ƛl} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \<[15]%
\>[15]\AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \<[31]%
\>[31]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∈} \AgdaInductiveConstructor{ƛ} \AgdaBound{a} \AgdaBound{M}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaKeyword{data} \AgdaDatatype{\_∉\_} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{)} \AgdaSymbol{:} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{∉v} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}} \<[31]%
\>[31]\AgdaSymbol{→} \AgdaBound{b} \AgdaFunction{≢} \AgdaBound{a} \<[48]%
\>[48]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∉} \AgdaInductiveConstructor{v} \AgdaBound{b} \<[58]%
\>[58]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{∉·} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \<[15]%
\>[15]\AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \<[31]%
\>[31]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∉} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∉} \AgdaBound{N} \<[48]%
\>[48]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∉} \AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{∉ƛ} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \<[25]%
\>[25]\AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \<[31]%
\>[31]\AgdaSymbol{→} \AgdaBound{b} \AgdaFunction{≢} \AgdaBound{a} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∉} \AgdaBound{M} \<[48]%
\>[48]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∉} \AgdaInductiveConstructor{ƛ} \AgdaBound{b} \AgdaBound{M}\<%
\end{code}

%<*fresh>
\begin{code}%
\>\AgdaKeyword{data} \AgdaDatatype{\_\#\_} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{)} \AgdaSymbol{:} \<[23]%
\>[23]\AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{\#v} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}} \<[28]%
\>[28]\AgdaSymbol{→} \AgdaBound{b} \AgdaFunction{≢} \AgdaBound{a} \<[45]%
\>[45]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaInductiveConstructor{v} \AgdaBound{b}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{\#·} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaDatatype{Λ} \AgdaSymbol{\}} \<[28]%
\>[28]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaBound{N} \<[45]%
\>[45]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{\#ƛ≡} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \<[45]%
\>[45]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaInductiveConstructor{ƛ} \AgdaBound{a} \AgdaBound{M}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{\#ƛ} \<[7]%
\>[7]\AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \<[28]%
\>[28]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaBound{M} \<[45]%
\>[45]\AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaInductiveConstructor{ƛ} \AgdaBound{b} \AgdaBound{M}\<%
\end{code}
%</fresh>

\begin{code}%
\>\AgdaKeyword{data} \AgdaDatatype{\_*\_} \AgdaSymbol{:} \AgdaFunction{Atom} \AgdaSymbol{→} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{*v} \<[7]%
\>[7]\AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}} \<[47]%
\>[47]\AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaInductiveConstructor{v} \AgdaBound{x}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{*·l} \<[7]%
\>[7]\AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M} \<[47]%
\>[47]\AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{*·r} \<[7]%
\>[7]\AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaBound{N} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{N} \<[47]%
\>[47]\AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{*ƛ} \<[7]%
\>[7]\AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{y} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{y} \AgdaFunction{≢} \AgdaBound{x} \<[47]%
\>[47]\AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemma\#λ} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{a} \AgdaBound{b} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{≢} \AgdaBound{b} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaInductiveConstructor{ƛ} \AgdaBound{b} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemma\#λ} \AgdaBound{b≢b} \AgdaInductiveConstructor{\#ƛ≡} \<[22]%
\>[22]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{b≢b} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma\#λ} \AgdaBound{a≢b} \AgdaSymbol{(}\AgdaInductiveConstructor{\#ƛ} \AgdaBound{a\#M}\AgdaSymbol{)} \<[22]%
\>[22]\AgdaSymbol{=} \AgdaBound{a\#M}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemma∉→¬∈} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∉} \AgdaBound{M} \AgdaSymbol{→} \AgdaFunction{¬} \AgdaSymbol{(}\AgdaBound{a} \AgdaDatatype{∈} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma∉→¬∈} \AgdaSymbol{(}\AgdaInductiveConstructor{∉v} \AgdaBound{a≢a}\AgdaSymbol{)} \AgdaInductiveConstructor{∈v} \<[36]%
\>[36]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{a≢a} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma∉→¬∈} \AgdaSymbol{(}\AgdaInductiveConstructor{∉·} \AgdaBound{a∉M} \AgdaBound{a∉N}\AgdaSymbol{)} \<[24]%
\>[24]\AgdaSymbol{(}\AgdaInductiveConstructor{∈·r} \AgdaBound{a∈N}\AgdaSymbol{)} \<[35]%
\>[35]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{lemma∉→¬∈} \AgdaBound{a∉N}\AgdaSymbol{)} \AgdaBound{a∈N}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma∉→¬∈} \AgdaSymbol{(}\AgdaInductiveConstructor{∉·} \AgdaBound{a∉M} \AgdaBound{a∉N}\AgdaSymbol{)} \<[24]%
\>[24]\AgdaSymbol{(}\AgdaInductiveConstructor{∈·l} \AgdaBound{a∈M}\AgdaSymbol{)} \<[35]%
\>[35]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{lemma∉→¬∈} \AgdaBound{a∉M}\AgdaSymbol{)} \AgdaBound{a∈M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma∉→¬∈} \AgdaSymbol{(}\AgdaInductiveConstructor{∉ƛ} \AgdaBound{b≢a} \AgdaBound{a∉M}\AgdaSymbol{)} \<[24]%
\>[24]\AgdaSymbol{(}\AgdaInductiveConstructor{∈ƛr} \AgdaBound{a∈M}\AgdaSymbol{)} \<[35]%
\>[35]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{lemma∉→¬∈} \AgdaBound{a∉M}\AgdaSymbol{)} \AgdaBound{a∈M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma∉→¬∈} \AgdaSymbol{(}\AgdaInductiveConstructor{∉ƛ} \AgdaBound{a≢a} \AgdaBound{a∉M}\AgdaSymbol{)} \<[24]%
\>[24]\AgdaInductiveConstructor{∈ƛl} \<[35]%
\>[35]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{a≢a} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemma∉→\#} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∉} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{\#} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemma∉→\#} \AgdaSymbol{(}\AgdaInductiveConstructor{∉v} \AgdaBound{b≢a}\AgdaSymbol{)} \<[24]%
\>[24]\AgdaSymbol{=} \AgdaInductiveConstructor{\#v} \AgdaBound{b≢a}\<%
\\
\>\AgdaFunction{lemma∉→\#} \AgdaSymbol{(}\AgdaInductiveConstructor{∉·} \AgdaBound{a∉M} \AgdaBound{a∉N}\AgdaSymbol{)} \<[23]%
\>[23]\AgdaSymbol{=} \AgdaInductiveConstructor{\#·} \AgdaSymbol{(}\AgdaFunction{lemma∉→\#} \AgdaBound{a∉M}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{lemma∉→\#} \AgdaBound{a∉N}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma∉→\#} \AgdaSymbol{(}\AgdaInductiveConstructor{∉ƛ} \AgdaBound{b≢a} \AgdaBound{a∉M}\AgdaSymbol{)} \<[24]%
\>[24]\AgdaSymbol{=} \AgdaInductiveConstructor{\#ƛ} \AgdaSymbol{(}\AgdaFunction{lemma∉→\#} \AgdaBound{a∉M}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemma-free→∈} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{∈} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemma-free→∈} \AgdaInductiveConstructor{*v} \<[27]%
\>[27]\AgdaSymbol{=} \AgdaInductiveConstructor{∈v}\<%
\\
\>\AgdaFunction{lemma-free→∈} \AgdaSymbol{(}\AgdaInductiveConstructor{*·l} \AgdaBound{x*M}\AgdaSymbol{)} \<[27]%
\>[27]\AgdaSymbol{=} \AgdaInductiveConstructor{∈·l} \AgdaSymbol{(}\AgdaFunction{lemma-free→∈} \AgdaBound{x*M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-free→∈} \AgdaSymbol{(}\AgdaInductiveConstructor{*·r} \AgdaBound{x*M}\AgdaSymbol{)} \<[27]%
\>[27]\AgdaSymbol{=} \AgdaInductiveConstructor{∈·r} \AgdaSymbol{(}\AgdaFunction{lemma-free→∈} \AgdaBound{x*M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-free→∈} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{x*M} \AgdaBound{y≢x}\AgdaSymbol{)} \<[27]%
\>[27]\AgdaSymbol{=} \AgdaInductiveConstructor{∈ƛr} \AgdaSymbol{(}\AgdaFunction{lemma-free→∈} \AgdaBound{x*M}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{ocurr} \AgdaSymbol{:} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaDatatype{List} \AgdaFunction{Atom}\<%
\\
\>\AgdaFunction{ocurr} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaBound{a}\AgdaSymbol{)} \<[15]%
\>[15]\AgdaSymbol{=} \AgdaFunction{[} \AgdaBound{a} \AgdaFunction{]}\<%
\\
\>\AgdaFunction{ocurr} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \<[15]%
\>[15]\AgdaSymbol{=} \AgdaFunction{ocurr} \AgdaBound{M} \AgdaFunction{++} \AgdaFunction{ocurr} \AgdaBound{N}\<%
\\
\>\AgdaFunction{ocurr} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{x} \AgdaBound{M}\AgdaSymbol{)} \<[15]%
\>[15]\AgdaSymbol{=} \AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaFunction{ocurr} \AgdaBound{M}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemmaocurr} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{a} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{a} \AgdaFunction{∉'} \AgdaFunction{ocurr} \AgdaBound{M} \AgdaSymbol{→} \AgdaBound{a} \AgdaDatatype{∉} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemmaocurr} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{b}\AgdaSymbol{\}} \<[24]%
\>[24]\AgdaBound{a∉[b]} \<[42]%
\>[42]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{b} \AgdaFunction{≟ₐ} \AgdaBound{a} \<[14]%
\>[14]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{b≢a} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaInductiveConstructor{∉v} \AgdaBound{b≢a}\<%
\\
\>\AgdaFunction{lemmaocurr} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaSymbol{.}\AgdaBound{a}\AgdaSymbol{\}} \<[25]%
\>[25]\AgdaBound{a∉[a]} \<[43]%
\>[43]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{a∉[a]} \AgdaSymbol{(}\AgdaInductiveConstructor{here} \AgdaInductiveConstructor{refl}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemmaocurr} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \<[24]%
\>[24]\AgdaBound{a∉ocurrM++ocurrN} \<[42]%
\>[42]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{∉·} \<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{lemmaocurr} \AgdaSymbol{(}\AgdaFunction{c∉xs++ys→c∉xs} \AgdaBound{a∉ocurrM++ocurrN}\AgdaSymbol{))}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{lemmaocurr} \AgdaSymbol{(}\AgdaFunction{c∉xs++ys→c∉ys} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaFunction{ocurr} \AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{a∉ocurrM++ocurrN}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemmaocurr} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{b} \AgdaBound{M}\AgdaSymbol{\}} \<[24]%
\>[24]\AgdaBound{a∉b∷ocurrM}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{b} \AgdaFunction{≟ₐ} \AgdaBound{a} \<[14]%
\>[14]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{b≢a} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaInductiveConstructor{∉ƛ} \AgdaBound{b≢a} \AgdaSymbol{(}\AgdaFunction{lemmaocurr} \AgdaSymbol{(}\AgdaBound{a∉b∷ocurrM} \AgdaFunction{∘} \AgdaInductiveConstructor{there}\AgdaSymbol{))} \<[59]%
\>[59]\<%
\\
\>\AgdaFunction{lemmaocurr} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaSymbol{.}\AgdaBound{a} \AgdaBound{M}\AgdaSymbol{\}} \<[25]%
\>[25]\AgdaBound{a∉b∷ocurrM}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{a∉b∷ocurrM} \AgdaSymbol{(}\AgdaInductiveConstructor{here} \AgdaInductiveConstructor{refl}\AgdaSymbol{))}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{\_\#?\_} \AgdaSymbol{:} \AgdaFunction{Decidable} \AgdaDatatype{\_\#\_}\<%
\\
\>\AgdaBound{x} \AgdaFunction{\#?} \AgdaSymbol{(}\AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{)} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟ₐ} \AgdaBound{x}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{y≡x} \AgdaSymbol{=} \AgdaInductiveConstructor{no} \AgdaSymbol{(λ} \AgdaSymbol{\{(}\AgdaInductiveConstructor{\#v} \AgdaBound{y≢x}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{y≢x} \AgdaBound{y≡x}\AgdaSymbol{\})}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{y≢x} \AgdaSymbol{=} \AgdaInductiveConstructor{yes} \AgdaSymbol{(}\AgdaInductiveConstructor{\#v} \AgdaBound{y≢x}\AgdaSymbol{)}\<%
\\
\>\AgdaBound{x} \AgdaFunction{\#?} \AgdaSymbol{(}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{)} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{\#?} \AgdaBound{M} \AgdaSymbol{|} \AgdaBound{x} \AgdaFunction{\#?} \AgdaBound{N} \<[34]%
\>[34]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x\#M} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \<[21]%
\>[21]\AgdaBound{x\#N} \AgdaSymbol{=} \AgdaInductiveConstructor{yes} \AgdaSymbol{(}\AgdaInductiveConstructor{\#·} \AgdaBound{x\#M} \AgdaBound{x\#N}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x\#M} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[20]%
\>[20]\AgdaBound{¬x\#N} \AgdaSymbol{=} \AgdaInductiveConstructor{no} \AgdaSymbol{(λ} \AgdaSymbol{\{(}\AgdaInductiveConstructor{\#·} \AgdaSymbol{\_} \AgdaBound{x\#N}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{¬x\#N} \AgdaBound{x\#N}\AgdaSymbol{\})}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{¬x\#M} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \<[21]%
\>[21]\AgdaBound{x\#N} \AgdaSymbol{=} \AgdaInductiveConstructor{no} \AgdaSymbol{(λ} \AgdaSymbol{\{(}\AgdaInductiveConstructor{\#·} \AgdaBound{x\#M} \AgdaSymbol{\_)} \<[47]%
\>[47]\AgdaSymbol{→} \AgdaBound{¬x\#M} \AgdaBound{x\#M}\AgdaSymbol{\})}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{¬x\#M} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[20]%
\>[20]\AgdaBound{¬x\#N} \AgdaSymbol{=} \AgdaInductiveConstructor{no} \AgdaSymbol{(λ} \AgdaSymbol{\{(}\AgdaInductiveConstructor{\#·} \AgdaBound{x\#M} \AgdaSymbol{\_)} \<[47]%
\>[47]\AgdaSymbol{→} \AgdaBound{¬x\#M} \AgdaBound{x\#M}\AgdaSymbol{\})}\<%
\\
\>\AgdaBound{x} \AgdaFunction{\#?} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \AgdaKeyword{with} \AgdaBound{y} \AgdaSymbol{|} \AgdaBound{x} \AgdaFunction{≟ₐ} \AgdaBound{y} \<[29]%
\>[29]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{\#ƛ≡}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaSymbol{\_} \<[9]%
\>[9]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[15]%
\>[15]\AgdaBound{x≢y} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{\#?} \AgdaBound{M}\<%
\\
\>\AgdaSymbol{...} \<[19]%
\>[19]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \<[26]%
\>[26]\AgdaBound{x\#M} \AgdaSymbol{=} \AgdaInductiveConstructor{yes} \AgdaSymbol{(}\AgdaInductiveConstructor{\#ƛ} \AgdaBound{x\#M}\AgdaSymbol{)} \<[45]%
\>[45]\<%
\\
\>\AgdaBound{x} \AgdaFunction{\#?} \AgdaSymbol{(}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{)} \<[13]%
\>[13]\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaBound{w} \<[9]%
\>[9]\AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[15]%
\>[15]\AgdaBound{x≢w} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[25]%
\>[25]\AgdaBound{¬x\#M} \AgdaSymbol{=} \AgdaInductiveConstructor{no} \AgdaSymbol{(}\AgdaFunction{aux} \AgdaBound{x≢w} \AgdaBound{¬x\#M}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where} \AgdaFunction{aux} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaBound{w} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaFunction{≢} \AgdaBound{w} \AgdaSymbol{→} \AgdaFunction{¬} \AgdaSymbol{(}\AgdaBound{x} \AgdaDatatype{\#} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \<[50]%
\>[50]\AgdaBound{x} \AgdaDatatype{\#} \AgdaInductiveConstructor{ƛ} \AgdaBound{w} \AgdaBound{M} \AgdaSymbol{→} \AgdaDatatype{⊥}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{aux} \AgdaBound{x≢w} \AgdaBound{¬x\#ƛwM} \AgdaInductiveConstructor{\#ƛ≡} \<[35]%
\>[35]\AgdaSymbol{=} \<[38]%
\>[38]\AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢w} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{aux} \AgdaBound{x≢w} \AgdaBound{¬x\#ƛwM} \AgdaSymbol{(}\AgdaInductiveConstructor{\#ƛ} \AgdaBound{x\#ƛwM}\AgdaSymbol{)} \<[35]%
\>[35]\AgdaSymbol{=} \<[38]%
\>[38]\AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{¬x\#ƛwM} \AgdaBound{x\#ƛwM}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemma¬\#→free} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaFunction{¬} \AgdaSymbol{(}\AgdaBound{x} \AgdaDatatype{\#} \AgdaBound{M}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M}\<%
\\
\>\AgdaFunction{lemma¬\#→free} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaBound{y}\AgdaSymbol{\}} \AgdaBound{¬x\#M} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟ₐ} \AgdaBound{x}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{y≢x} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{¬x\#M} \AgdaSymbol{(}\AgdaInductiveConstructor{\#v} \AgdaBound{y≢x}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{lemma¬\#→free} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaSymbol{.}\AgdaBound{x}\AgdaSymbol{\}} \AgdaBound{¬x\#M} \<[29]%
\>[29]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \<[16]%
\>[16]\AgdaSymbol{=} \AgdaInductiveConstructor{*v}\<%
\\
\>\AgdaFunction{lemma¬\#→free} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaBound{¬x\#MN} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{\#?} \AgdaBound{M} \AgdaSymbol{|} \AgdaBound{x} \AgdaFunction{\#?} \AgdaBound{N} \<[52]%
\>[52]\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x\#M} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x\#N} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{¬x\#MN} \AgdaSymbol{(}\AgdaInductiveConstructor{\#·} \AgdaBound{x\#M} \AgdaBound{x\#N}\AgdaSymbol{))}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x\#M} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{¬x\#N} \AgdaSymbol{=} \AgdaInductiveConstructor{*·r} \AgdaSymbol{(}\AgdaFunction{lemma¬\#→free} \AgdaBound{¬x\#N}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{¬x\#M} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x\#N} \AgdaSymbol{=} \AgdaInductiveConstructor{*·l} \AgdaSymbol{(}\AgdaFunction{lemma¬\#→free} \AgdaBound{¬x\#M}\AgdaSymbol{)}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{¬x\#M} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{¬x\#N} \AgdaSymbol{=} \AgdaInductiveConstructor{*·r} \AgdaSymbol{(}\AgdaFunction{lemma¬\#→free} \AgdaBound{¬x\#N}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma¬\#→free} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{¬x\#λxM} \AgdaKeyword{with} \AgdaBound{y} \AgdaFunction{≟ₐ} \AgdaBound{x}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \<[10]%
\>[10]\AgdaBound{y≢x} \AgdaKeyword{with} \AgdaBound{x} \AgdaFunction{\#?} \AgdaBound{M}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaBound{x\#M} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{¬x\#λxM} \AgdaSymbol{(}\AgdaInductiveConstructor{\#ƛ} \AgdaBound{x\#M}\AgdaSymbol{))}\<%
\\
\>\AgdaSymbol{...} \AgdaSymbol{|} \AgdaInductiveConstructor{no} \AgdaBound{¬x\#M} \AgdaSymbol{=} \AgdaInductiveConstructor{*ƛ} \AgdaSymbol{(}\AgdaFunction{lemma¬\#→free} \AgdaBound{¬x\#M}\AgdaSymbol{)} \AgdaBound{y≢x}\<%
\\
\>\AgdaFunction{lemma¬\#→free} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaSymbol{.}\AgdaBound{x} \AgdaBound{M}\AgdaSymbol{\}} \AgdaBound{¬x\#λxM} \<[33]%
\>[33]\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{yes} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{¬x\#λxM} \AgdaInductiveConstructor{\#ƛ≡}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaFunction{lemma-free→¬\#} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{x} \AgdaSymbol{:} \AgdaFunction{Atom}\AgdaSymbol{\}\{}\AgdaBound{M} \AgdaSymbol{:} \AgdaDatatype{Λ}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{x} \AgdaDatatype{*} \AgdaBound{M} \AgdaSymbol{→} \<[45]%
\>[45]\AgdaFunction{¬} \AgdaSymbol{(}\AgdaBound{x} \AgdaDatatype{\#} \AgdaBound{M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-free→¬\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{v} \AgdaSymbol{.}\AgdaBound{x}\AgdaSymbol{\}} \AgdaInductiveConstructor{*v} \<[39]%
\>[39]\AgdaSymbol{(}\AgdaInductiveConstructor{\#v} \AgdaBound{x≢x}\AgdaSymbol{)} \<[48]%
\>[48]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢x} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-free→¬\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{*·l} \AgdaBound{xfreeM}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{\#·} \AgdaBound{x\#M} \AgdaBound{x\#N}\AgdaSymbol{)} \<[52]%
\>[52]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{lemma-free→¬\#} \AgdaBound{xfreeM}\AgdaSymbol{)} \AgdaBound{x\#M}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-free→¬\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{*·r} \AgdaBound{xfreeN}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{\#·} \AgdaBound{x\#M} \AgdaBound{x\#N}\AgdaSymbol{)} \<[52]%
\>[52]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{lemma-free→¬\#} \AgdaBound{xfreeN}\AgdaSymbol{)} \AgdaBound{x\#N}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-free→¬\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaSymbol{.}\AgdaBound{x} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{xfreeM} \AgdaBound{x≢x}\AgdaSymbol{)} \AgdaInductiveConstructor{\#ƛ≡}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{(}\AgdaBound{x≢x} \AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma-free→¬\#} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaInductiveConstructor{ƛ} \AgdaBound{y} \AgdaBound{M}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaInductiveConstructor{*ƛ} \AgdaBound{xfreeM} \AgdaBound{y≢x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{\#ƛ} \AgdaBound{x\#M}\AgdaSymbol{)} \<[52]%
\>[52]\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{⊥-elim} \AgdaSymbol{((}\AgdaFunction{lemma-free→¬\#} \AgdaBound{xfreeM}\AgdaSymbol{)} \AgdaBound{x\#M}\AgdaSymbol{)}\<%
\\
\>\<%
\end{code}

Term swap

%<*swap>
\begin{code}%
\>\AgdaFunction{（\_∙\_）\_} \AgdaSymbol{:} \AgdaFunction{Atom} \AgdaSymbol{→} \AgdaFunction{Atom} \AgdaSymbol{→} \AgdaDatatype{Λ} \AgdaSymbol{→} \AgdaDatatype{Λ}\<%
\\
\>\AgdaFunction{（} \AgdaBound{a} \AgdaFunction{∙} \AgdaBound{b} \AgdaFunction{）} \AgdaInductiveConstructor{v} \AgdaBound{c} \<[17]%
\>[17]\AgdaSymbol{=} \AgdaInductiveConstructor{v} \AgdaSymbol{(}\AgdaFunction{（} \AgdaBound{a} \AgdaFunction{∙} \AgdaBound{b} \AgdaFunction{）ₐ} \AgdaBound{c}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{（} \AgdaBound{a} \AgdaFunction{∙} \AgdaBound{b} \AgdaFunction{）} \AgdaBound{M} \AgdaInductiveConstructor{·} \AgdaBound{N} \<[17]%
\>[17]\AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{（} \AgdaBound{a} \AgdaFunction{∙} \AgdaBound{b} \AgdaFunction{）} \AgdaBound{M}\AgdaSymbol{)} \AgdaInductiveConstructor{·} \<[36]%
\>[36]\AgdaSymbol{(}\AgdaFunction{（} \AgdaBound{a} \AgdaFunction{∙} \AgdaBound{b} \AgdaFunction{）} \AgdaBound{N}\AgdaSymbol{)} \<[51]%
\>[51]\<%
\\
\>\AgdaFunction{（} \AgdaBound{a} \AgdaFunction{∙} \AgdaBound{b} \AgdaFunction{）} \AgdaInductiveConstructor{ƛ} \AgdaBound{c} \AgdaBound{M} \<[17]%
\>[17]\AgdaSymbol{=} \AgdaInductiveConstructor{ƛ} \AgdaSymbol{(}\AgdaFunction{（} \AgdaBound{a} \AgdaFunction{∙} \AgdaBound{b} \AgdaFunction{）ₐ} \AgdaBound{c}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{（} \AgdaBound{a} \AgdaFunction{∙} \AgdaBound{b} \AgdaFunction{）} \AgdaBound{M}\AgdaSymbol{)}\<%
\end{code}
%</swap>

\begin{code}%
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma∙cancel∉ : \{a b : Atom\}\{M : Λ\} → a ∉ M → b ∉ M → （ a ∙ b ） M ≡ M }\<%
\\
\>\AgdaComment{lemma∙cancel∉ \{a\} \{b\} \{v c\}    (∉v c≢a)      (∉v c≢b)     = cong v (lemma∙ₐc≢a∧c≢b c≢a c≢b)}\<%
\\
\>\AgdaComment{lemma∙cancel∉ \{a\} \{b\} \{M · N\}  (∉· a∉M a∉N)  (∉· b∉M b∉N) = cong₂ \_·\_ (lemma∙cancel∉ a∉M b∉M) (lemma∙cancel∉ a∉N b∉N)}\<%
\\
\>\AgdaComment{lemma∙cancel∉ \{a\} \{b\} \{ƛ c M\}  (∉ƛ c≢a a∉M)  (∉ƛ c≢b b∉M) = cong₂ ƛ (lemma∙ₐc≢a∧c≢b c≢a c≢b) (lemma∙cancel∉ a∉M b∉M)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma∙∣∣ : \{M : Λ\}\{a b : Atom\} → ∣ （ a ∙ b ） M ∣ ≡ ∣ M ∣ }\<%
\\
\>\AgdaComment{lemma∙∣∣ \{v c\}    = refl}\<%
\\
\>\AgdaComment{lemma∙∣∣ \{M · N\}  = cong₂ \_+\_ (lemma∙∣∣ \{M\}) (lemma∙∣∣ \{N\})}\<%
\\
\>\AgdaComment{lemma∙∣∣ \{ƛ c M\}  = cong suc (lemma∙∣∣ \{M\})}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma∙∣∣≤ : \{M : Λ\}\{a b : Atom\} → ∣ （ a ∙ b ） M ∣ ≤′ ∣ M ∣ }\<%
\\
\>\AgdaComment{lemma∙∣∣≤ \{M\} \{a\} \{b\} rewrite lemma∙∣∣ \{M\} \{a\} \{b\} = ≤′-refl}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma∙∙∣∣≤ :  ∀ \{a\} \{b\} \{c\} \{M\} → ∣ （ b ∙ c ） （ a ∙ b ） M ∣ ≤′ ∣ M ∣}\<%
\\
\>\AgdaComment{lemma∙∙∣∣≤ \{a\} \{b\} \{c\} \{M\} rewrite lemma∙∣∣ \{（ a ∙ b ） M\} \{b\} \{c\} | lemma∙∣∣ \{M\} \{a\} \{b\} = ≤′-refl}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma（aa）M≡M : \{a : Atom\}\{M : Λ\} → （ a ∙ a ） M ≡ M }\<%
\\
\>\AgdaComment{lemma（aa）M≡M \{a\} \{v b\}    = cong   v    lemma（aa）b≡b}\<%
\\
\>\AgdaComment{lemma（aa）M≡M \{a\} \{M · N\}  = cong₂  \_·\_  lemma（aa）M≡M  lemma（aa）M≡M}\<%
\\
\>\AgdaComment{lemma（aa）M≡M \{a\} \{ƛ b M\}  = cong₂  ƛ    lemma（aa）b≡b  lemma（aa）M≡M}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma（ab）（ab）M≡M : \{a b : Atom\}\{M : Λ\} → （ a ∙ b ） （ a ∙ b ） M ≡ M }\<%
\\
\>\AgdaComment{lemma（ab）（ab）M≡M \{a\} \{b\} \{v c\}    = cong   v    lemma（ab）（ab）c≡c}\<%
\\
\>\AgdaComment{lemma（ab）（ab）M≡M \{a\} \{b\} \{M · N\}  = cong₂  \_·\_  lemma（ab）（ab）M≡M  lemma（ab）（ab）M≡M}\<%
\\
\>\AgdaComment{lemma（ab）（ab）M≡M \{a\} \{b\} \{ƛ c M\}  = cong₂  ƛ    lemma（ab）（ab）c≡c  lemma（ab）（ab）M≡M}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma∙comm : \{a b : Atom\}\{M : Λ\} → （ a ∙ b ） M ≡ （ b ∙ a ） M }\<%
\\
\>\AgdaComment{lemma∙comm \{a\} \{b\} \{v c\}    = cong   v    (lemma∙ₐcomm \{a\} \{b\} \{c\})}\<%
\\
\>\AgdaComment{lemma∙comm \{a\} \{b\} \{M · N\}  = cong₂  \_·\_  lemma∙comm                 lemma∙comm}\<%
\\
\>\AgdaComment{lemma∙comm \{a\} \{b\} \{ƛ c M\}  = cong₂  ƛ    (lemma∙ₐcomm \{a\} \{b\} \{c\})  lemma∙comm}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma∙distributive :  \{a b c d : Atom\}\{M : Λ\} →}\<%
\\
\>\AgdaComment{                      （ a ∙ b ） （ c ∙ d ） M ≡ （ （ a ∙ b ）ₐ c ∙ （ a ∙ b ）ₐ d ） （ a ∙ b ） M}\<%
\\
\>\AgdaComment{lemma∙distributive \{a\} \{b\} \{c\} \{d\} \{v e\}    }\<%
\\
\>\AgdaComment{  = cong   v    (lemma∙ₐdistributive a b c d e)}\<%
\\
\>\AgdaComment{lemma∙distributive \{a\} \{b\} \{c\} \{d\} \{M · N\}  }\<%
\\
\>\AgdaComment{  = cong₂  \_·\_  (lemma∙distributive \{a\} \{b\} \{c\} \{d\})  lemma∙distributive}\<%
\\
\>\AgdaComment{lemma∙distributive \{a\} \{b\} \{c\} \{d\} \{ƛ e M\}  }\<%
\\
\>\AgdaComment{  = cong₂  ƛ    (lemma∙ₐdistributive a b c d e)       lemma∙distributive}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{-- lemma∙distributive2 :  \{a b c d : Atom\}\{M : Λ\} →}\<%
\\
\>\AgdaComment{--                        （ a ∙ b ） （ c ∙ d ） M ≡ （ c ∙ d ） （ （ c ∙ d ）ₐ a ∙ （ c ∙ d ）ₐ b ） M}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma∙cancel : \{a b c : Atom\}\{M : Λ\} → b ∉ M → c ∉ M → （ c ∙ b ） （ a ∙ c ） M ≡ （ a ∙ b ） M }\<%
\\
\>\AgdaComment{lemma∙cancel \{a\} \{b\} \{c\} \{v d\}    (∉v d≢b)      (∉v d≢c)       = cong v     (lemma∙ₐcancel d≢b d≢c)}\<%
\\
\>\AgdaComment{lemma∙cancel \{a\} \{b\} \{c\} \{M · N\}  (∉· b∉M b∉N)  (∉· c∉M c∉N)   = cong₂ \_·\_  (lemma∙cancel b∉M c∉M)   (lemma∙cancel b∉N c∉N)}\<%
\\
\>\AgdaComment{lemma∙cancel \{a\} \{b\} \{c\} \{ƛ d M\}  (∉ƛ d≢b b∉M)  (∉ƛ d≢c c∉M)   = cong₂ ƛ    (lemma∙ₐcancel d≢b d≢c)  (lemma∙cancel b∉M c∉M)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{fv : Λ → List Atom}\<%
\\
\>\AgdaComment{fv (v a)     = [ a ]}\<%
\\
\>\AgdaComment{fv (M · N)   = fv M ++ fv N}\<%
\\
\>\AgdaComment{fv (ƛ a M)   = fv M - a}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemmafvfree→ : (x : Atom)(M : Λ) → x ∈' fv M → x * M}\<%
\\
\>\AgdaComment{lemmafvfree→ x (v y)    (here x≡y) with y ≟ x }\<%
\\
\>\AgdaComment{... | no   y≢x = ⊥-elim (y≢x (sym x≡y)) }\<%
\\
\>\AgdaComment{lemmafvfree→ x (v .x)    (here x≡x) }\<%
\\
\>\AgdaComment{    | yes  refl = *v}\<%
\\
\>\AgdaComment{lemmafvfree→ x (v y) (there ()) }\<%
\\
\>\AgdaComment{lemmafvfree→ x (M · N)  x∈fvMN with c∈xs++ys→c∈xs∨c∈ys  x∈fvMN }\<%
\\
\>\AgdaComment{... | inj₁ x∈fvM = *·l (lemmafvfree→ x M x∈fvM)}\<%
\\
\>\AgdaComment{... | inj₂ x∈fvN = *·r (lemmafvfree→ x N x∈fvN)}\<%
\\
\>\AgdaComment{lemmafvfree→ x (ƛ y M)  x∈fvM-y with y ≟ x | lemmafilter→ x (fv M) (λ z → not (⌊ y ≟ z ⌋)) x∈fvM-y}\<%
\\
\>\AgdaComment{... | no y≢x   | \_ , x∈fvM = *ƛ (lemmafvfree→ x M x∈fvM) y≢x }\<%
\\
\>\AgdaComment{lemmafvfree→ x (ƛ .x M)  x∈fvM-y }\<%
\\
\>\AgdaComment{    | yes refl | () , \_  }\<%
\\
\>\AgdaComment{-- }\<%
\\
\>\AgdaComment{lemmafvfree← : (x : Atom)(M : Λ) → x * M → x ∈' fv M}\<%
\\
\>\AgdaComment{lemmafvfree← x (v .x)    *v             }\<%
\\
\>\AgdaComment{  = here refl}\<%
\\
\>\AgdaComment{lemmafvfree← x .(M · N)  (*·l \{.x\} \{M\} \{N\} xfreeM)     }\<%
\\
\>\AgdaComment{  = c∈xs∨c∈ys→c∈xs++ys (inj₁ (lemmafvfree← x M xfreeM))}\<%
\\
\>\AgdaComment{lemmafvfree← x .(M · N)  (*·r \{.x\} \{M\} \{N\} xfreeN)     }\<%
\\
\>\AgdaComment{  = c∈xs∨c∈ys→c∈xs++ys \{x\} \{fv M\} (inj₂ (lemmafvfree← x N xfreeN))}\<%
\\
\>\AgdaComment{lemmafvfree← x .(ƛ y M)  (*ƛ \{.x\} \{y\} \{M\} xfreeM y≢x)  }\<%
\\
\>\AgdaComment{  = filter-∈ (λ z → not (⌊ y ≟ z ⌋)) (fv M) \{x\} (lemmafvfree← x M xfreeM) px≡true }\<%
\\
\>\AgdaComment{  where }\<%
\\
\>\AgdaComment{  px≡true : not ⌊ y ≟ x ⌋ ≡ true}\<%
\\
\>\AgdaComment{  px≡true with y ≟ x}\<%
\\
\>\AgdaComment{  ... | yes y≡x = ⊥-elim (y≢x y≡x)}\<%
\\
\>\AgdaComment{  ... | no  \_   = refl}\<%
\\
\>\AgdaComment{-- Chi encapsulation}\<%
\\
\>\AgdaComment{χ : List Atom → Λ → Atom}\<%
\\
\>\AgdaComment{χ xs M = χ' (xs ++ fv M) }\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{χ'∉ : (xs : List Atom) → χ' xs ∉' xs}\<%
\\
\>\AgdaComment{χ'∉ = lemmaχaux∉}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{χ∉ : (xs : List Atom)(M : Λ) → χ xs M ∉' xs}\<%
\\
\>\AgdaComment{χ∉ xs M = c∉xs++ys→c∉xs  (χ'∉ (xs ++ fv M))}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{χ\# : (xs : List Atom)(M : Λ) → χ xs M \# M}\<%
\\
\>\AgdaComment{χ\# xs M with (χ xs M) \#? M}\<%
\\
\>\AgdaComment{... | yes χ\#M = χ\#M}\<%
\\
\>\AgdaComment{... | no ¬χ\#M = ⊥-elim ((c∉xs++ys→c∉ys \{χ xs M\} \{xs\} (lemmaχaux∉ (xs ++ fv M))) (lemmafvfree← (χ xs M) M (lemma¬\#→free ¬χ\#M))) }\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma*swap→ : \{a b c : Atom\}\{M : Λ\} → a ≢ c → a ≢ b → a * M → a * （ b ∙ c ） M}\<%
\\
\>\AgdaComment{lemma*swap→ \{a\} \{b\} \{c\} \{v .a\} a≢c a≢b *v with （ b ∙ c ）ₐ a | lemma∙ₐ b c a}\<%
\\
\>\AgdaComment{... | \_   | inj₁ (a≡b , \_)              = ⊥-elim (a≢b a≡b)}\<%
\\
\>\AgdaComment{... | \_   | inj₂ (inj₁ (a≡c , \_))       = ⊥-elim (a≢c a≡c)}\<%
\\
\>\AgdaComment{... | .a  | inj₂ (inj₂ (\_ , \_ , refl))  = *v}\<%
\\
\>\AgdaComment{lemma*swap→ a≢c a≢b (*·l a*M) = *·l (lemma*swap→ a≢c a≢b a*M)}\<%
\\
\>\AgdaComment{lemma*swap→ a≢c a≢b (*·r a*M) = *·r (lemma*swap→ a≢c a≢b a*M)}\<%
\\
\>\AgdaComment{lemma*swap→ \{a\} \{b\} \{c\} \{ƛ d M\} a≢c a≢b (*ƛ a*M d≢a) }\<%
\\
\>\AgdaComment{  with （ b ∙ c ）ₐ d | lemma∙ₐ b c d}\<%
\\
\>\AgdaComment{... | .c  | inj₁ (d≡b , refl)               = *ƛ (lemma*swap→ a≢c a≢b a*M) (sym≢ a≢c)}\<%
\\
\>\AgdaComment{... | .b  | inj₂ (inj₁ (d≡c , \_   , refl))        = *ƛ (lemma*swap→ a≢c a≢b a*M) (sym≢ a≢b)}\<%
\\
\>\AgdaComment{... | .d  | inj₂ (inj₂ (d≢b , d≢c , refl))  = *ƛ (lemma*swap→ a≢c a≢b a*M) d≢a}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma*swap← : \{a b c : Atom\}\{M : Λ\} → a * （ b ∙ c ） M → (a ≢ b × a ≢ c × a * M) ∨ (a ≡ b × c * M) ∨ (a ≡ c × b * M)}\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{b\} \{c\} \{v d\}   a*（bc）d with （ b ∙ c ）ₐ d | lemma∙ₐ b c d }\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{b\} \{.a\} \{v .b\} *v | .a | inj₁ (refl , refl)              = inj₂ (inj₂ (refl , *v))}\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{.a\} \{c\} \{v .c\} *v | .a | inj₂ (inj₁ (refl , \_  , refl))  = inj₂ (inj₁ (refl , *v))}\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{b\} \{c\} \{v .a\}  *v | .a | inj₂ (inj₂ (a≢b , a≢c , refl))  = inj₁ (a≢b , a≢c  , *v) }\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{b\} \{c\} \{M · N\}   (*·l a*（bc）M)  = map+ (mapₓ id (mapₓ id *·l)) (map+ (mapₓ id *·l) (mapₓ id *·l)) (lemma*swap← a*（bc）M)}\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{b\} \{c\} \{M · N\}   (*·r a*（bc）N)  = map+ (mapₓ id (mapₓ id *·r)) (map+ (mapₓ id *·r) (mapₓ id *·r)) (lemma*swap← a*（bc）N)}\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{b\} \{c\} \{ƛ d M\}   (*ƛ a*（bc）M （bc）d≢a) with （ b ∙ c ）ₐ d | lemma∙ₐ b c d}\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{b\} \{c\} \{ƛ .b M\}  (*ƛ a*（bc）M c≢a)  | .c | inj₁ (refl , refl) with lemma*swap← a*（bc）M }\<%
\\
\>\AgdaComment{... | inj₁ (a≢b , a≢c , a*M)    =  inj₁ (a≢b , a≢c , *ƛ a*M (sym≢ a≢b))}\<%
\\
\>\AgdaComment{... | inj₂ (inj₂ (a≡c , b*M))   = ⊥-elim (c≢a (sym a≡c))}\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{.a\} \{c\} \{ƛ .a M\} (*ƛ a*（bc）M c≢a)  | .c | inj₁ (refl , refl) }\<%
\\
\>\AgdaComment{    | inj₂ (inj₁ (refl , c*M))  =  inj₂ (inj₁ (refl , *ƛ c*M (sym≢ c≢a)))}\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{b\} \{c\} \{ƛ .c M\} (*ƛ a*（bc）M b≢a)  | .b | inj₂ (inj₁ (refl , \_ , refl)) with lemma*swap← a*（bc）M }\<%
\\
\>\AgdaComment{... | inj₁ (a≢b , a≢c , a*M)    = inj₁ (a≢b , a≢c , *ƛ a*M (sym≢ a≢c))}\<%
\\
\>\AgdaComment{... | inj₂ (inj₁ (a≡b , c*M))   =  ⊥-elim (b≢a (sym a≡b))}\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{b\} \{.a\} \{ƛ .a M\} (*ƛ a*（ba）M b≢a)  | .a | inj₂ (inj₁ (refl , \_ , refl))}\<%
\\
\>\AgdaComment{    | inj₂ (inj₂ (refl , b*M))  = inj₂ (inj₂ (refl , *ƛ b*M (sym≢ b≢a)))}\<%
\\
\>\AgdaComment{lemma*swap← \{a\} \{b\} \{c\} \{ƛ d M\} (*ƛ a*（bc）M d≢a)   | .d | inj₂ (inj₂ (d≢b , d≢c , refl)) }\<%
\\
\>\AgdaComment{  with lemma*swap← a*（bc）M }\<%
\\
\>\AgdaComment{... | inj₁ (a≢b , a≢c , a*M)        = inj₁ (a≢b , a≢c , *ƛ a*M d≢a)}\<%
\\
\>\AgdaComment{... | inj₂ (inj₁ (a≡b , c*M))   = inj₂ (inj₁ (a≡b , *ƛ c*M d≢c))}\<%
\\
\>\AgdaComment{... | inj₂ (inj₂ (a≡c , b*M))   = inj₂ (inj₂ (a≡c , *ƛ b*M d≢b))}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{lemma*swap←≢ : \{a b c : Atom\}\{M : Λ\} → a ≢ b → a ≢ c → a * （ b ∙ c ） M → a * M}\<%
\\
\>\AgdaComment{lemma*swap←≢ \{a\} \{b\}  \{c\}   \{M\} a≢b a≢c a*（bc）M  with lemma*swap← \{a\} \{b\} \{c\} \{M\} a*（bc）M}\<%
\\
\>\AgdaComment{lemma*swap←≢ \{a\} \{b\}  \{c\}   \{M\} a≢b a≢c a*（bc）M | inj₁ (\_ , \_ , a*M) = a*M}\<%
\\
\>\AgdaComment{lemma*swap←≢ \{a\} \{.a\} \{c\}   \{M\} a≢a a≢c a*（bc）M | inj₂ (inj₁ (refl , \_)) = ⊥-elim (a≢a refl)}\<%
\\
\>\AgdaComment{lemma*swap←≢ \{a\} \{b\}  \{.a\}  \{M\} a≢b a≢a a*（bc）M | inj₂ (inj₂ (refl , \_)) = ⊥-elim (a≢a refl)}\<%
\\
\>\<%
\end{code}
